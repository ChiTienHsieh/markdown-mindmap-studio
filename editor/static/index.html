<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title id="page-title">Mindmap Editor</title>
    <link rel="icon" type="image/svg+xml" href="/static/favicon.svg">
    <!-- Premium Typography: Geist (Vercel) + JetBrains Mono -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=JetBrains+Mono:wght@400;500&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="/static/style.css?v=12">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/markmap-toolbar@0.18.12/dist/style.css">
</head>
<body>
    <div class="app">
        <!-- Header -->
        <header class="header">
            <h1 id="header-title">Mindmap Editor</h1>
            <div class="header-actions">
                <span id="connection-status" class="status disconnected">‚óè Disconnected</span>
                <button id="btn-theme-toggle" class="icon-btn" title="">
                    <svg class="icon-sun" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <circle cx="12" cy="12" r="5"/>
                        <path d="M12 1v2M12 21v2M4.22 4.22l1.42 1.42M18.36 18.36l1.42 1.42M1 12h2M21 12h2M4.22 19.78l1.42-1.42M18.36 5.64l1.42-1.42"/>
                    </svg>
                    <svg class="icon-moon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"/>
                    </svg>
                </button>
                <button id="btn-refresh" class="icon-btn" title="">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M23 4v6h-6M1 20v-6h6"/>
                        <path d="M3.51 9a9 9 0 0 1 14.85-3.36L23 10M1 14l4.64 4.36A9 9 0 0 0 20.49 15"/>
                    </svg>
                </button>
            </div>
        </header>

        <!-- Main content - Minimalist Layout -->
        <div class="main">
            <!-- Floating Toggle Toolbar -->
            <div class="floating-toolbar" id="floating-toolbar">
                <button id="btn-toggle-sidebar" class="toolbar-toggle" title="Toggle Files (‚åò1)">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M3 3h7v18H3zM10 3h11v18H10z"/>
                    </svg>
                    <span>Files</span>
                </button>
                <button id="btn-toggle-editor" class="toolbar-toggle" title="Toggle Editor (‚åò2)">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M12 19l7-7 3 3-7 7-3-3z"/>
                        <path d="M18 13l-1.5-7.5L2 2l3.5 14.5L13 18l5-5z"/>
                        <path d="M2 2l7.586 7.586"/>
                    </svg>
                    <span>Editor</span>
                </button>
                <button id="btn-toggle-agent" class="toolbar-toggle" title="Toggle Agent (‚åò3)">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"/>
                    </svg>
                    <span>Agent</span>
                </button>
                <div class="toolbar-divider"></div>
                <label class="toolbar-toggle edit-toggle" title="Edit Mode">
                    <input type="checkbox" id="toggle-edit-mode">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"/>
                        <path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"/>
                    </svg>
                    <span>Edit</span>
                </label>
                <div class="toolbar-divider"></div>
                <div class="export-dropdown" id="export-dropdown">
                    <button class="toolbar-toggle" id="btn-export" title="Export">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/>
                            <polyline points="7 10 12 15 17 10"/>
                            <line x1="12" y1="15" x2="12" y2="3"/>
                        </svg>
                        <span>Export</span>
                    </button>
                    <div class="export-menu hidden" id="export-menu">
                        <button id="export-png" class="export-option">PNG Image</button>
                        <button id="export-html" class="export-option">HTML (Interactive)</button>
                        <button id="export-pdf" class="export-option">PDF Document</button>
                    </div>
                </div>
            </div>

            <!-- File sidebar - Hidden by default -->
            <aside class="sidebar collapsed" id="sidebar">
                <div class="sidebar-header">
                    <h2>Files</h2>
                    <button id="btn-expand-all" class="expand-btn" title="Toggle expand/collapse all">
                        <span class="expand-icon">‚äü</span> Collapse
                    </button>
                </div>
                <div id="file-list" class="file-list">
                    <!-- Files will be loaded here -->
                </div>
            </aside>

            <!-- Split pane: Editor + Mindmap -->
            <div class="content">
                <!-- Markdown editor pane - Hidden by default -->
                <div class="pane editor-pane collapsed" id="editor-pane">
                    <div class="pane-toolbar">
                        <span id="current-file" class="file-indicator">No file selected</span>
                        <div class="toolbar-actions">
                            <button id="btn-save" class="icon-btn" disabled title="">
                                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <path d="M19 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11l5 5v11a2 2 0 0 1-2 2z"/>
                                    <polyline points="17 21 17 13 7 13 7 21"/>
                                    <polyline points="7 3 7 8 15 8"/>
                                </svg>
                            </button>
                        </div>
                    </div>
                    <textarea id="markdown-editor" placeholder="Select a file from the sidebar to edit..."></textarea>
                </div>

                <!-- Resize handle -->
                <div class="resize-handle hidden" id="resize-handle"></div>

                <!-- Mindmap pane - Hero element, always visible -->
                <div class="pane mindmap-pane" id="mindmap-pane">
                    <svg id="mindmap"></svg>
                </div>
            </div>
        </div>

        <!-- Edit modal -->
        <div id="edit-modal" class="modal hidden">
            <div class="modal-content">
                <h3>Edit Node</h3>
                <textarea id="edit-input"></textarea>
                <div class="modal-actions">
                    <button id="edit-cancel">Cancel</button>
                    <button id="edit-save" class="primary">Save</button>
                </div>
            </div>
        </div>

        <!-- Agent Chat Panel - Hidden by default -->
        <div id="agent-panel" class="agent-panel collapsed hidden-panel">
            <div class="agent-panel-header">
                <span>ü§ñ Agent Chat</span>
                <span id="agent-status" class="agent-status">Checking...</span>
                <button id="agent-toggle" class="agent-toggle" title="Toggle Agent Panel">‚ñ≤</button>
            </div>
            <div class="agent-panel-body">
                <div id="agent-messages" class="agent-messages">
                    <div id="agent-welcome" class="agent-welcome"></div>
                </div>
                <div class="agent-input-area">
                    <textarea id="agent-input" placeholder="" rows="1"></textarea>
                    <button id="agent-send" class="primary" title=""></button>
                </div>
            </div>
        </div>
    </div>

    <!-- Scripts -->
    <script src="https://cdn.jsdelivr.net/npm/d3@7.9.0/dist/d3.min.js"></script>
    <!-- markmap-lib must load FIRST to ensure Transformer is available -->
    <script src="https://cdn.jsdelivr.net/npm/markmap-lib@0.18.12/dist/browser/index.iife.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/markmap-view@0.18.12/dist/browser/index.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/markmap-toolbar@0.18.12/dist/index.js"></script>
    <script src="/static/editor.js"></script>
</body>
</html>
